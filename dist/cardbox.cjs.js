"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var fs=_interopDefault(require("fs-extra")),glob=_interopDefault(require("glob"));const default_length=16,create_random_id=(t=16)=>{(t<=0||"number"!=typeof t)&&(t=16);let s="";for(;t--;)s+=Math.floor(16*Math.random()+1).toString(16).toUpperCase();return s},default_options={path:"./data/",spaces:2,random:()=>create_random_id(6),sync:{create:!0,read:!1,update:!0,delete:!0}};class CardBox{constructor(t=default_options){this._options=Object.assign({},default_options,t,{sync:Object.assign({},default_options.sync,t.sync)},{format:Object.assign({},default_options.format,t.format)}),this._options.path+=this._options.path.endsWith("/")?"":"/",this._cards={}}_card_path(t){return`${this._options.path}${t}.json`}async init(){await fs.ensureDir(this._options.path)}async load(){return await this.init(),new Promise(t=>{glob(`${this._options.path}**/*.json`,{},(s,e)=>{s&&console.error(s),e.forEach(t=>{const s=fs.readJsonSync(t,t=>{t&&console.error(t)});this._cards[s.id]=s}),t(!0)})})}async create(t={}){return t.id||(t.id=this._options.random()),this._cards[t.id]=t,await fs.writeJson(this._card_path(t.id),t,{spaces:this._options.spaces}),t}async read(t){return new Promise(s=>{t||s(Object.values(this._cards)),s(this._cards[t])})}async update(t,s=this._options.sync.update){return new Promise(async e=>{e(await this.create(t,s))})}async delete(t,s=this._options.sync.update){return new Promise(e=>{t&&this._cards[t]||e(!1);const a=this._card_path(t);fs.remove(a,t=>{t&&console.error(t),!0===s&&e(!0)}),delete this._cards[t],!1===s&&e(!0)})}}module.exports=CardBox;
